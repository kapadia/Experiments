// Generated by CoffeeScript 1.6.3
(function() {
  var PORT, RedisStore, TWITTER_ACCESS_TOKEN_URL, TWITTER_CONSUMER_KEY, TWITTER_CONSUMER_SECRET, TWITTER_REQUEST_TOKEN_URL, TwitterStrategy, app, express, http, passport, server;

  express = require('express');

  http = require('http');

  RedisStore = require('connect-redis')(express);

  passport = require('passport');

  TwitterStrategy = require('passport-twitter').Strategy;

  PORT = 8000;

  app = express();

  server = http.createServer(app);

  server.listen(PORT);

  app.use(express.cookieParser());

  app.use(express.session({
    store: new RedisStore({
      host: 'localhost',
      port: process.env.REDIS_PORT,
      db: process.env.REDIS_DB,
      pass: process.env.REDIS_PASS
    }),
    secret: 'asdf'
  }));

  TWITTER_REQUEST_TOKEN_URL = "https://twitter.com/oauth/request_token";

  TWITTER_ACCESS_TOKEN_URL = "https://twitter.com/oauth/access_token";

  TWITTER_CONSUMER_KEY = process.env.TWITTER_CONSUMER_KEY;

  TWITTER_CONSUMER_SECRET = process.env.TWITTER_CONSUMER_SECRET;

  passport.use(new TwitterStrategy({
    consumerKey: TWITTER_CONSUMER_KEY,
    consumerSecret: TWITTER_CONSUMER_SECRET,
    callbackURL: "/success"
  }, function(token, tokenSecret, profile, done) {
    console.log("token", token);
    console.log("tokenSecret", tokenSecret);
    console.log("profile", profile);
    return console.log("done", done);
  }));

  app.get("/", function(req, res) {
    return res.send("Hello World");
  });

  app.get("/success", function(req, res) {
    return res.send("Success!");
  });

  app.get("/failure", function(req, res) {
    return res.send("Failure.");
  });

  app.get("/auth/twitter", passport.authenticate('twitter'));

  app.get('/auth/twitter/callback', passport.authenticate('twitter', {
    successRedirect: '/success',
    failureRedirect: '/failure'
  }));

}).call(this);
